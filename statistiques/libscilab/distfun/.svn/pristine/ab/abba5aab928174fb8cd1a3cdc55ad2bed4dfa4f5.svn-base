// Copyright (C) 2012 - Prateek Papriwal
// Copyright (C) 2012 - Michael Baudin
//
// This file must be used under the terms of the CeCILL.
// This source file is licensed as described in the file COPYING, which
// you should have received as part of this distribution.  The terms
// are also available at
// http://www.cecill.info/licences/Licence_CeCILL_V2-en.txt
// <-- JVM NOT MANDATORY -->
path = distfun_getpath (  );
exec(fullfile(path,"tests","unit_tests","testingutilities.sce"));
//
// Consistency Checks
//
lambda=80;
x=[
    69.  
    75.  
    80.  
    85.  
    92.  
];
rtol=1.e-12;
CheckCDF("distfun_poisscdf",list(distfun_poisscdf,lambda),x,rtol);
CheckCDF: Checking empty matrix...
CheckCDF: p=distfun_poisscdf([],[])
CheckCDF: ... OK
CheckCDF: Get reference quantiles...
CheckCDF: p(1)=distfun_poisscdf(69,80)
CheckCDF: p(2)=distfun_poisscdf(75,80)
CheckCDF: p(3)=distfun_poisscdf(80,80)
CheckCDF: p(4)=distfun_poisscdf(85,80)
CheckCDF: p(5)=distfun_poisscdf(92,80)
CheckCDF: ... OK
CheckCDF: Compute complementary probabilities...
CheckCDF: (check that p+q=1)
CheckCDF: q=distfun_poisscdf([69;75;80;85;92],80,%F)
CheckCDF: ... OK
CheckCDF: With arguments expanded...
CheckCDF: p=distfun_poisscdf([69;75;80;85;92],80)
CheckCDF: p=distfun_poisscdf([69;75;80;85;92],[80;80;80;80;80])
CheckCDF: ... OK
// Accuracy tests
//
precision = 1.e-5;
path = distfun_getpath();
dataset = fullfile(path,"tests","unit_tests","poiss","poisson.dataset.csv");
table = readCsvDataset(dataset);
ntests = size(table,"r");
for i = 1 : ntests
    if (i==32) then
        // See bug http://forge.scilab.org/index.php/p/distfun/issues/961
        continue
    end
  x = table(i,1);
  lambda = table(i,2);
  p = table(i,4);
  q = table(i,5);
  computed = distfun_poisscdf(x,lambda);
  assert_checkalmostequal ( computed , p , precision );
  computed = distfun_poisscdf(x,lambda,%f);
  assert_checkalmostequal ( computed , q , precision );
end
//
// Tests from Yalta
// table = [x lambda p precision]
//
path=distfun_getpath();
dataset = fullfile(path,"tests","unit_tests","poiss","poisson.cdf.yalta.dataset.csv");
table = readCsvDataset(dataset);
precision = 1.e-5;
nt = size(table,"r");
for k = 1 : nt
  Xk = table(k,1);
  lambda = table(k,2);
  expected = table(k,3);
  computed=distfun_poisscdf(Xk,lambda);
  assert_checkalmostequal ( computed , expected , precision );
  if ( %f ) then
    dp = assert_computedigits ( expected , computed );
    mprintf("Test #%3d/%3d: Digits P= %.1f\n",k,nt,dp);
  end
end
